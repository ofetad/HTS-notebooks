

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Using tidyr to create tidy data sets &mdash; HTS2018 1.0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> HTS2018
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Slides:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../slides.html">Slide sets</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">HTS2018</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Using <code class="docutils literal notranslate"><span class="pre">tidyr</span></code> to create tidy data sets</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/cliburn/R_tidyverse_2.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput div.prompt,
div.nbinput div.input_area,
div.nbinput div[class*=highlight],
div.nbinput div[class*=highlight] pre,
div.nboutput,
div.nbinput div.prompt,
div.nbinput div.output_area,
div.nboutput div[class*=highlight],
div.nboutput div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput,
    div.nboutput {
        flex-direction: column;
    }
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput div.prompt pre {
    color: #303F9F;
}

/* output prompt */
div.nboutput div.prompt pre {
    color: #D84315;
}

/* all prompts */
div.nbinput div.prompt,
div.nboutput div.prompt {
    min-width: 8ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput div.prompt,
    div.nboutput div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput div.prompt pre,
div.nboutput div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput div.input_area,
div.nboutput div.output_area {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput div.input_area,
    div.nboutput div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput div.input_area {
    border: 1px solid #cfcfcf;
    border-radius: 2px;
    background: #f7f7f7;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.pngmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast,
.nboutput.nblast {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast + .nbinput {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}
</style>
<div class="section" id="Using-tidyr-to-create-tidy-data-sets">
<h1>Using <code class="docutils literal notranslate"><span class="pre">tidyr</span></code> to create tidy data sets<a class="headerlink" href="#Using-tidyr-to-create-tidy-data-sets" title="Permalink to this headline">¶</a></h1>
<p><strong>Description</strong> &gt; Easily Tidy Data with ‘spread()’ and ‘gather()’
Functions</p>
<p>A tidy data frame is one where</p>
<ul class="simple">
<li>Each column is a variable</li>
<li>Each row is an observatino</li>
<li>Each value is a cell</li>
</ul>
<p>As we have seen, tidy data sets can be easily plotted with <code class="docutils literal notranslate"><span class="pre">ggplot2</span></code>
and manipulated with <code class="docutils literal notranslate"><span class="pre">dplyr</span></code>. In this notebook, we see how to convert
messy data sets into tidy ones using the verbs <code class="docutils literal notranslate"><span class="pre">gather</span></code>, <code class="docutils literal notranslate"><span class="pre">spread</span></code>,
<code class="docutils literal notranslate"><span class="pre">separate</span></code>, <code class="docutils literal notranslate"><span class="pre">extract</span></code>, <code class="docutils literal notranslate"><span class="pre">separte_rows</span></code> and <code class="docutils literal notranslate"><span class="pre">unite</span></code>.</p>
<p>For more complicated tidying jobs, see the full range of functions in
the <code class="docutils literal notranslate"><span class="pre">`tidyr</span></code>
documentation &lt;<a class="reference external" href="https://cran.r-project.org/web/packages/tidyr/tidyr.pdf">https://cran.r-project.org/web/packages/tidyr/tidyr.pdf</a>&gt;`__.</p>
library(tidyverse)<div class="section" id="Data">
<h2>Data<a class="headerlink" href="#Data" title="Permalink to this headline">¶</a></h2>
<p>We will work with a subset of the pilot metadata that we are familiar
with from the <code class="docutils literal notranslate"><span class="pre">dplyr</span></code> session.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [3]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span>path<span class="o">=</span><span class="s">&#39;../josh/info/2018_pilot_metadata.tsv&#39;</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [4]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span>df <span class="o">&lt;-</span> read_tsv<span class="p">(</span>path<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
Parsed with column specification:
cols(
  Label = col_character(),
  RNA_sample_num = col_integer(),
  Media = col_character(),
  Strain = col_character(),
  Replicate = col_integer(),
  experiment_person = col_character(),
  libprep_person = col_character(),
  enrichment_method = col_character(),
  RIN = col_double(),
  concentration_fold_difference = col_double(),
  `i7 index` = col_character(),
  `i5 index` = col_character(),
  `i5 primer` = col_character(),
  `i7 primer` = col_character(),
  `library#` = col_integer()
)
</pre></div></div>
</div>
<div class="section" id="Subset-the-data">
<h3>Subset the data<a class="headerlink" href="#Subset-the-data" title="Permalink to this headline">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [10]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span>df <span class="o">&lt;-</span> df <span class="o">%&gt;%</span> select<span class="p">(</span>
    Label<span class="p">,</span>
    RNA_sample_num<span class="p">,</span>
    Media<span class="p">,</span>
    Strain<span class="p">,</span>
    Replicate<span class="p">,</span>
    concentration_fold_difference<span class="p">,</span>
    <span class="sb">`i7 index`</span><span class="p">,</span>
    <span class="sb">`i5 index`</span><span class="p">,</span>
    <span class="sb">`i5 primer`</span><span class="p">,</span>
    <span class="sb">`i7 primer`</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [11]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="kp">head</span><span class="p">(</span>df<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<table>
<thead><tr><th scope=col>Label</th><th scope=col>RNA_sample_num</th><th scope=col>Media</th><th scope=col>Strain</th><th scope=col>Replicate</th><th scope=col>concentration_fold_difference</th><th scope=col>i7 index</th><th scope=col>i5 index</th><th scope=col>i5 primer</th><th scope=col>i7 primer</th></tr></thead>
<tbody>
    <tr><td>2_MA_C  </td><td> 2      </td><td>YPD     </td><td>H99     </td><td>2       </td><td>1.34    </td><td>ATTACTCG</td><td>AGGCTATA</td><td>i501    </td><td>i701    </td></tr>
    <tr><td>9_MA_C  </td><td> 9      </td><td>YPD     </td><td>mar1d   </td><td>3       </td><td>2.23    </td><td>ATTACTCG</td><td>GCCTCTAT</td><td>i502    </td><td>i701    </td></tr>
    <tr><td>10_MA_C </td><td>10      </td><td>YPD     </td><td>mar1d   </td><td>4       </td><td>4.37    </td><td>ATTACTCG</td><td>AGGATAGG</td><td>i503    </td><td>i701    </td></tr>
    <tr><td>14_MA_C </td><td>14      </td><td>TC      </td><td>H99     </td><td>2       </td><td>1.57    </td><td>ATTACTCG</td><td>TCAGAGCC</td><td>i504    </td><td>i701    </td></tr>
    <tr><td>15_MA_C </td><td>15      </td><td>TC      </td><td>H99     </td><td>3       </td><td>2.85    </td><td>ATTACTCG</td><td>CTTCGCCT</td><td>i505    </td><td>i701    </td></tr>
    <tr><td>21_MA_C </td><td>21      </td><td>TC      </td><td>mar1d   </td><td>3       </td><td>1.81    </td><td>ATTACTCG</td><td>TAAGATTA</td><td>i506    </td><td>i701    </td></tr>
</tbody>
</table></div>
</div>
</div>
</div>
<div class="section" id="1.-Use-gather-to-combine-multiple-columns-into-one">
<h2>1. Use <code class="docutils literal notranslate"><span class="pre">gather</span></code> to combine multiple columns into one<a class="headerlink" href="#1.-Use-gather-to-combine-multiple-columns-into-one" title="Permalink to this headline">¶</a></h2>
<p>We note thet there are two “index” and “primer” columns - for a tidy
data frame, we probably want to combine them. We cna do this using
<code class="docutils literal notranslate"><span class="pre">gather</span></code>.</p>
<div class="section" id="Warm-up">
<h3>Warm-up<a class="headerlink" href="#Warm-up" title="Permalink to this headline">¶</a></h3>
<p>The use of <code class="docutils literal notranslate"><span class="pre">gather</span></code> can be confusing, so we will start with a toy
example.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [90]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span>name <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="s">&#39;ann&#39;</span><span class="p">,</span> <span class="s">&#39;bob&#39;</span><span class="p">,</span> <span class="s">&#39;charlie&#39;</span><span class="p">)</span>
jan <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="m">102</span><span class="p">,</span> <span class="m">155</span><span class="p">,</span> <span class="m">211</span><span class="p">)</span>
feb <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="m">112</span><span class="p">,</span> <span class="m">150</span><span class="p">,</span> <span class="m">211</span><span class="p">)</span>
mar <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="m">123</span><span class="p">,</span> <span class="m">147</span><span class="p">,</span> <span class="m">213</span><span class="p">)</span>
apr <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="m">130</span><span class="p">,</span> <span class="m">140</span><span class="p">,</span> <span class="m">210</span><span class="p">)</span>

wts <span class="o">&lt;-</span> tibble<span class="p">(</span>name<span class="o">=</span>name<span class="p">,</span> jan<span class="o">=</span>jan<span class="p">,</span> feb<span class="o">=</span>feb<span class="p">,</span> mar<span class="o">=</span>mar<span class="p">,</span> apr<span class="o">=</span>apr<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [91]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span>wts
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<table>
<thead><tr><th scope=col>name</th><th scope=col>jan</th><th scope=col>feb</th><th scope=col>mar</th><th scope=col>apr</th></tr></thead>
<tbody>
    <tr><td>ann    </td><td>102    </td><td>112    </td><td>123    </td><td>130    </td></tr>
    <tr><td>bob    </td><td>155    </td><td>150    </td><td>147    </td><td>140    </td></tr>
    <tr><td>charlie</td><td>211    </td><td>211    </td><td>213    </td><td>210    </td></tr>
</tbody>
</table></div>
</div>
</div>
<div class="section" id="Messy-data">
<h3>Messy data<a class="headerlink" href="#Messy-data" title="Permalink to this headline">¶</a></h3>
<p>In the current form, it is not possible to subgroup by month or to plot
by month easily.</p>
</div>
<div class="section" id="Using-gather-to-creat-a-new-column-called-weight-to-store-monthly-weights">
<h3>Using <code class="docutils literal notranslate"><span class="pre">gather</span></code> to creat a new column called <code class="docutils literal notranslate"><span class="pre">weight</span></code> to store monthly weights<a class="headerlink" href="#Using-gather-to-creat-a-new-column-called-weight-to-store-monthly-weights" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [93]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span>wts <span class="o">%&gt;%</span> gather<span class="p">(</span>key<span class="o">=</span>month<span class="p">,</span> value<span class="o">=</span>weight<span class="p">,</span> jan<span class="o">:</span>apr<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<table>
<thead><tr><th scope=col>name</th><th scope=col>month</th><th scope=col>weight</th></tr></thead>
<tbody>
    <tr><td>ann    </td><td>jan    </td><td>102    </td></tr>
    <tr><td>bob    </td><td>jan    </td><td>155    </td></tr>
    <tr><td>charlie</td><td>jan    </td><td>211    </td></tr>
    <tr><td>ann    </td><td>feb    </td><td>112    </td></tr>
    <tr><td>bob    </td><td>feb    </td><td>150    </td></tr>
    <tr><td>charlie</td><td>feb    </td><td>211    </td></tr>
    <tr><td>ann    </td><td>mar    </td><td>123    </td></tr>
    <tr><td>bob    </td><td>mar    </td><td>147    </td></tr>
    <tr><td>charlie</td><td>mar    </td><td>213    </td></tr>
    <tr><td>ann    </td><td>apr    </td><td>130    </td></tr>
    <tr><td>bob    </td><td>apr    </td><td>140    </td></tr>
    <tr><td>charlie</td><td>apr    </td><td>210    </td></tr>
</tbody>
</table></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [97]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span>wts.1 <span class="o">&lt;-</span> wts <span class="o">%&gt;%</span> gather<span class="p">(</span>key<span class="o">=</span>month<span class="p">,</span> value<span class="o">=</span>weight<span class="p">,</span> jan<span class="o">:</span>apr<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="To-get-menth-sorted-correctly,-we-make-it-a-factor">
<h3>To get menth sorted correctly, we make it a factor<a class="headerlink" href="#To-get-menth-sorted-correctly,-we-make-it-a-factor" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [102]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span>wts.1 <span class="o">%&gt;%</span> mutate<span class="p">(</span>month <span class="o">=</span> <span class="kp">factor</span><span class="p">(</span>month<span class="p">,</span>
                                ordered <span class="o">=</span> <span class="kc">TRUE</span><span class="p">,</span>
                                levels <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="s">&#39;jan&#39;</span><span class="p">,</span> <span class="s">&#39;feb&#39;</span><span class="p">,</span> <span class="s">&#39;mar&#39;</span><span class="p">,</span> <span class="s">&#39;apr&#39;</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<table>
<thead><tr><th scope=col>name</th><th scope=col>month</th><th scope=col>weight</th></tr></thead>
<tbody>
    <tr><td>ann    </td><td>jan    </td><td>102    </td></tr>
    <tr><td>bob    </td><td>jan    </td><td>155    </td></tr>
    <tr><td>charlie</td><td>jan    </td><td>211    </td></tr>
    <tr><td>ann    </td><td>feb    </td><td>112    </td></tr>
    <tr><td>bob    </td><td>feb    </td><td>150    </td></tr>
    <tr><td>charlie</td><td>feb    </td><td>211    </td></tr>
    <tr><td>ann    </td><td>mar    </td><td>123    </td></tr>
    <tr><td>bob    </td><td>mar    </td><td>147    </td></tr>
    <tr><td>charlie</td><td>mar    </td><td>213    </td></tr>
    <tr><td>ann    </td><td>apr    </td><td>130    </td></tr>
    <tr><td>bob    </td><td>apr    </td><td>140    </td></tr>
    <tr><td>charlie</td><td>apr    </td><td>210    </td></tr>
</tbody>
</table></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [103]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span>wts.2 <span class="o">&lt;-</span> wts.1 <span class="o">%&gt;%</span> mutate<span class="p">(</span>month <span class="o">=</span> <span class="kp">factor</span><span class="p">(</span>month<span class="p">,</span>
                                ordered <span class="o">=</span> <span class="kc">TRUE</span><span class="p">,</span>
                                levels <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="s">&#39;jan&#39;</span><span class="p">,</span> <span class="s">&#39;feb&#39;</span><span class="p">,</span> <span class="s">&#39;mar&#39;</span><span class="p">,</span> <span class="s">&#39;apr&#39;</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Now-we-can-easily-work-wtih-the-tidy-data-set">
<h3>Now we can easily work wtih the tidy data set<a class="headerlink" href="#Now-we-can-easily-work-wtih-the-tidy-data-set" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [106]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span>wts.2 <span class="o">%&gt;%</span>
group_by<span class="p">(</span>month<span class="p">)</span> <span class="o">%&gt;%</span>
summarize_at<span class="p">(</span><span class="s">&#39;weight&#39;</span><span class="p">,</span> funs<span class="p">(</span><span class="kp">min</span><span class="p">,</span> <span class="kp">max</span><span class="p">,</span> <span class="kp">mean</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<table>
<thead><tr><th scope=col>month</th><th scope=col>min</th><th scope=col>max</th><th scope=col>mean</th></tr></thead>
<tbody>
    <tr><td>jan     </td><td>102     </td><td>211     </td><td>156.0000</td></tr>
    <tr><td>feb     </td><td>112     </td><td>211     </td><td>157.6667</td></tr>
    <tr><td>mar     </td><td>123     </td><td>213     </td><td>161.0000</td></tr>
    <tr><td>apr     </td><td>130     </td><td>210     </td><td>160.0000</td></tr>
</tbody>
</table></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [119]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span><span class="kp">options</span><span class="p">(</span>repr.plot.width<span class="o">=</span><span class="m">6</span><span class="p">,</span> repr.plot.height<span class="o">=</span><span class="m">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [120]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span>ggplot<span class="p">(</span>wts.2<span class="p">,</span> aes<span class="p">(</span>x<span class="o">=</span>month<span class="p">,</span> y<span class="o">=</span>weight<span class="p">,</span> fill<span class="o">=</span>name<span class="p">))</span> <span class="o">+</span>
geom_bar<span class="p">(</span>stat<span class="o">=</span><span class="s">&#39;identity&#39;</span><span class="p">)</span> <span class="o">+</span>
facet_wrap<span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="admonition warning">
Data type cannot be displayed:</div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/cliburn_R_tidyverse_2_23_1.png" src="../_images/cliburn_R_tidyverse_2_23_1.png" />
</div>
</div>
</div>
<div class="section" id="Using-gather-on-experiment-metadata">
<h3>Using <code class="docutils literal notranslate"><span class="pre">gather</span></code> on experiment metadata<a class="headerlink" href="#Using-gather-on-experiment-metadata" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [235]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span>df <span class="o">%&gt;%</span>
select<span class="p">(</span>Label<span class="p">,</span> ends_with<span class="p">(</span><span class="s">&#39;index&#39;</span><span class="p">))</span> <span class="o">%&gt;%</span>
<span class="kp">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<table>
<thead><tr><th scope=col>Label</th><th scope=col>i7 index</th><th scope=col>i5 index</th></tr></thead>
<tbody>
    <tr><td>2_MA_C  </td><td>ATTACTCG</td><td>AGGCTATA</td></tr>
    <tr><td>9_MA_C  </td><td>ATTACTCG</td><td>GCCTCTAT</td></tr>
    <tr><td>10_MA_C </td><td>ATTACTCG</td><td>AGGATAGG</td></tr>
    <tr><td>14_MA_C </td><td>ATTACTCG</td><td>TCAGAGCC</td></tr>
    <tr><td>15_MA_C </td><td>ATTACTCG</td><td>CTTCGCCT</td></tr>
    <tr><td>21_MA_C </td><td>ATTACTCG</td><td>TAAGATTA</td></tr>
</tbody>
</table></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [237]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span>df <span class="o">%&gt;%</span>
select<span class="p">(</span>Label<span class="p">,</span> ends_with<span class="p">(</span><span class="s">&#39;index&#39;</span><span class="p">))</span> <span class="o">%&gt;%</span>
gather<span class="p">(</span>index<span class="p">,</span> <span class="kp">sequence</span><span class="p">,</span> <span class="o">-</span>Label<span class="p">)</span> <span class="o">%&gt;%</span>
<span class="kp">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<table>
<thead><tr><th scope=col>Label</th><th scope=col>index</th><th scope=col>sequence</th></tr></thead>
<tbody>
    <tr><td>2_MA_C  </td><td>i7 index</td><td>ATTACTCG</td></tr>
    <tr><td>9_MA_C  </td><td>i7 index</td><td>ATTACTCG</td></tr>
    <tr><td>10_MA_C </td><td>i7 index</td><td>ATTACTCG</td></tr>
    <tr><td>14_MA_C </td><td>i7 index</td><td>ATTACTCG</td></tr>
    <tr><td>15_MA_C </td><td>i7 index</td><td>ATTACTCG</td></tr>
    <tr><td>21_MA_C </td><td>i7 index</td><td>ATTACTCG</td></tr>
</tbody>
</table></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [239]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span>df <span class="o">%&gt;%</span>
select<span class="p">(</span>Label<span class="p">,</span> ends_with<span class="p">(</span><span class="s">&#39;index&#39;</span><span class="p">))</span> <span class="o">%&gt;%</span>
gather<span class="p">(</span>index<span class="p">,</span> <span class="kp">sequence</span><span class="p">,</span> <span class="o">-</span>Label<span class="p">)</span> <span class="o">%&gt;%</span>
mutate<span class="p">(</span>index<span class="o">=</span>str_extract<span class="p">(</span>index<span class="p">,</span> <span class="s">&#39;^..&#39;</span><span class="p">))</span> <span class="o">%&gt;%</span>
<span class="kp">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<table>
<thead><tr><th scope=col>Label</th><th scope=col>index</th><th scope=col>sequence</th></tr></thead>
<tbody>
    <tr><td>2_MA_C  </td><td>i7      </td><td>ATTACTCG</td></tr>
    <tr><td>9_MA_C  </td><td>i7      </td><td>ATTACTCG</td></tr>
    <tr><td>10_MA_C </td><td>i7      </td><td>ATTACTCG</td></tr>
    <tr><td>14_MA_C </td><td>i7      </td><td>ATTACTCG</td></tr>
    <tr><td>15_MA_C </td><td>i7      </td><td>ATTACTCG</td></tr>
    <tr><td>21_MA_C </td><td>i7      </td><td>ATTACTCG</td></tr>
</tbody>
</table></div>
</div>
</div>
</div>
<div class="section" id="2.-Use-spread-to-convert-one-column-into-multiple">
<h2>2. Use <code class="docutils literal notranslate"><span class="pre">spread</span></code> to convert one column into multiple<a class="headerlink" href="#2.-Use-spread-to-convert-one-column-into-multiple" title="Permalink to this headline">¶</a></h2>
<p>We can undo <code class="docutils literal notranslate"><span class="pre">gather</span></code> with <code class="docutils literal notranslate"><span class="pre">spread</span></code>. This is less commonly used than
<code class="docutils literal notranslate"><span class="pre">gather</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [240]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span>df <span class="o">%&gt;%</span>
select<span class="p">(</span>Label<span class="p">,</span> ends_with<span class="p">(</span><span class="s">&#39;index&#39;</span><span class="p">))</span> <span class="o">%&gt;%</span>
gather<span class="p">(</span>index<span class="p">,</span> <span class="kp">sequence</span><span class="p">,</span> <span class="o">-</span>Label<span class="p">)</span> <span class="o">%&gt;%</span>
<span class="kp">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<table>
<thead><tr><th scope=col>Label</th><th scope=col>index</th><th scope=col>sequence</th></tr></thead>
<tbody>
    <tr><td>2_MA_C  </td><td>i7 index</td><td>ATTACTCG</td></tr>
    <tr><td>9_MA_C  </td><td>i7 index</td><td>ATTACTCG</td></tr>
    <tr><td>10_MA_C </td><td>i7 index</td><td>ATTACTCG</td></tr>
    <tr><td>14_MA_C </td><td>i7 index</td><td>ATTACTCG</td></tr>
    <tr><td>15_MA_C </td><td>i7 index</td><td>ATTACTCG</td></tr>
    <tr><td>21_MA_C </td><td>i7 index</td><td>ATTACTCG</td></tr>
</tbody>
</table></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [241]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span>df <span class="o">%&gt;%</span>
select<span class="p">(</span>Label<span class="p">,</span> ends_with<span class="p">(</span><span class="s">&#39;index&#39;</span><span class="p">))</span> <span class="o">%&gt;%</span>
gather<span class="p">(</span>index<span class="p">,</span> <span class="kp">sequence</span><span class="p">,</span> <span class="o">-</span>Label<span class="p">)</span> <span class="o">%&gt;%</span>
spread<span class="p">(</span>index<span class="p">,</span> <span class="kp">sequence</span><span class="p">)</span> <span class="o">%&gt;%</span>
<span class="kp">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<table>
<thead><tr><th scope=col>Label</th><th scope=col>i5 index</th><th scope=col>i7 index</th></tr></thead>
<tbody>
    <tr><td>1_MA_J  </td><td>AGGCTATA</td><td>CGCTCATT</td></tr>
    <tr><td>1_RZ_J  </td><td>AGGCTATA</td><td>GAGATTCC</td></tr>
    <tr><td>10_MA_C </td><td>AGGATAGG</td><td>ATTACTCG</td></tr>
    <tr><td>10_RZ_C </td><td>AGGATAGG</td><td>TCCGGAGA</td></tr>
    <tr><td>11_MA_J </td><td>AGGATAGG</td><td>CGCTCATT</td></tr>
    <tr><td>11_RZ_J </td><td>AGGATAGG</td><td>GAGATTCC</td></tr>
</tbody>
</table></div>
</div>
</div>
<div class="section" id="3.-Use-separate-to-split-a-single-column-containing-multiple-values">
<h2>3. Use <code class="docutils literal notranslate"><span class="pre">separate</span></code> to split a single column containing multiple values<a class="headerlink" href="#3.-Use-separate-to-split-a-single-column-containing-multiple-values" title="Permalink to this headline">¶</a></h2>
<p>The label column actually contains three pieces of informaiton separated
by underscores - a sample number, the RNA enrichment methd, and code for
the person presenting the sample. Assuuming that we do not have this
informatio nduplicate in other columns, it woujld be tricky to compare,
say, results by the sampling method.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">separate</span></code> function is designed to address this problem.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [246]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span>df <span class="o">%&gt;%</span>
select<span class="p">(</span>Label<span class="p">,</span> concentration_fold_difference<span class="p">)</span> <span class="o">%&gt;%</span>
<span class="kp">head</span><span class="p">(</span><span class="m">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<table>
<thead><tr><th scope=col>Label</th><th scope=col>concentration_fold_difference</th></tr></thead>
<tbody>
    <tr><td>2_MA_C </td><td>1.34   </td></tr>
    <tr><td>9_MA_C </td><td>2.23   </td></tr>
    <tr><td>10_MA_C</td><td>4.37   </td></tr>
</tbody>
</table></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [249]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span>df <span class="o">%&gt;%</span>
select<span class="p">(</span>Label<span class="p">,</span> concentration_fold_difference<span class="p">)</span> <span class="o">%&gt;%</span>
separate<span class="p">(</span>Label<span class="p">,</span> sep<span class="o">=</span><span class="s">&#39;_&#39;</span><span class="p">,</span> into<span class="o">=</span><span class="kt">c</span><span class="p">(</span><span class="s">&#39;sample_num&#39;</span><span class="p">,</span> <span class="s">&#39;enrichment&#39;</span><span class="p">,</span> <span class="s">&#39;person&#39;</span><span class="p">))</span> <span class="o">%&gt;%</span>
<span class="kp">head</span><span class="p">(</span><span class="m">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<table>
<thead><tr><th scope=col>sample_num</th><th scope=col>enrichment</th><th scope=col>person</th><th scope=col>concentration_fold_difference</th></tr></thead>
<tbody>
    <tr><td>2   </td><td>MA  </td><td>C   </td><td>1.34</td></tr>
    <tr><td>9   </td><td>MA  </td><td>C   </td><td>2.23</td></tr>
    <tr><td>10  </td><td>MA  </td><td>C   </td><td>4.37</td></tr>
</tbody>
</table></div>
</div>
<p>Here is a summary of the data.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [278]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span>df <span class="o">%&gt;%</span>
select<span class="p">(</span>Label<span class="p">,</span> concentration_fold_difference<span class="p">)</span> <span class="o">%&gt;%</span>
separate<span class="p">(</span>Label<span class="p">,</span> into<span class="o">=</span><span class="kt">c</span><span class="p">(</span><span class="s">&#39;sample_num&#39;</span><span class="p">,</span> <span class="s">&#39;enrichment&#39;</span><span class="p">,</span> <span class="s">&#39;person&#39;</span><span class="p">),</span> sep<span class="o">=</span><span class="s">&#39;_&#39;</span><span class="p">)</span> <span class="o">%&gt;%</span>
add_count<span class="p">(</span>enrichment<span class="p">)</span> <span class="o">%&gt;%</span>
group_by<span class="p">(</span>person<span class="p">,</span> enrichment<span class="p">,</span> n<span class="p">)</span> <span class="o">%&gt;%</span>
summarize_at<span class="p">(</span><span class="s">&#39;concentration_fold_difference&#39;</span><span class="p">,</span> <span class="kp">mean</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<table>
<thead><tr><th scope=col>person</th><th scope=col>enrichment</th><th scope=col>n</th><th scope=col>concentration_fold_difference</th></tr></thead>
<tbody>
    <tr><td>C     </td><td>MA    </td><td>24    </td><td>2.3675</td></tr>
    <tr><td>C     </td><td>RZ    </td><td>24    </td><td>2.3675</td></tr>
    <tr><td>C     </td><td>TOT   </td><td> 3    </td><td>1.3400</td></tr>
    <tr><td>J     </td><td>MA    </td><td>24    </td><td>3.4350</td></tr>
    <tr><td>J     </td><td>RZ    </td><td>24    </td><td>3.4350</td></tr>
    <tr><td>J     </td><td>TOT   </td><td> 3    </td><td>1.9800</td></tr>
    <tr><td>P     </td><td>MA    </td><td>24    </td><td>3.0800</td></tr>
    <tr><td>P     </td><td>RZ    </td><td>24    </td><td>3.0800</td></tr>
    <tr><td>P     </td><td>TOT   </td><td> 3    </td><td>2.0500</td></tr>
</tbody>
</table></div>
</div>
</div>
<div class="section" id="4.-Use-unite-to-craate-a-single-variable-from-multiple-columns">
<h2>4. Use <code class="docutils literal notranslate"><span class="pre">unite</span></code> to craate a single variable from multiple columns<a class="headerlink" href="#4.-Use-unite-to-craate-a-single-variable-from-multiple-columns" title="Permalink to this headline">¶</a></h2>
<p>Sometimes we want to do the opposite and combine multiple columns into a
single column. Use <code class="docutils literal notranslate"><span class="pre">unite</span></code> to do this.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [276]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span>df <span class="o">%&gt;%</span>
select<span class="p">(</span>Label<span class="p">,</span> concentration_fold_difference<span class="p">)</span> <span class="o">%&gt;%</span>
separate<span class="p">(</span>Label<span class="p">,</span> sep<span class="o">=</span><span class="s">&#39;_&#39;</span><span class="p">,</span> into<span class="o">=</span><span class="kt">c</span><span class="p">(</span><span class="s">&#39;sample_num&#39;</span><span class="p">,</span> <span class="s">&#39;enrichment&#39;</span><span class="p">,</span> <span class="s">&#39;person&#39;</span><span class="p">))</span> <span class="o">%&gt;%</span>
<span class="kp">head</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<table>
<thead><tr><th scope=col>sample_num</th><th scope=col>enrichment</th><th scope=col>person</th><th scope=col>concentration_fold_difference</th></tr></thead>
<tbody>
    <tr><td>2   </td><td>MA  </td><td>C   </td><td>1.34</td></tr>
    <tr><td>9   </td><td>MA  </td><td>C   </td><td>2.23</td></tr>
    <tr><td>10  </td><td>MA  </td><td>C   </td><td>4.37</td></tr>
    <tr><td>14  </td><td>MA  </td><td>C   </td><td>1.57</td></tr>
    <tr><td>15  </td><td>MA  </td><td>C   </td><td>2.85</td></tr>
    <tr><td>21  </td><td>MA  </td><td>C   </td><td>1.81</td></tr>
</tbody>
</table></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [277]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span>df <span class="o">%&gt;%</span>
select<span class="p">(</span>Label<span class="p">,</span> concentration_fold_difference<span class="p">)</span> <span class="o">%&gt;%</span>
separate<span class="p">(</span>Label<span class="p">,</span> sep<span class="o">=</span><span class="s">&#39;_&#39;</span><span class="p">,</span> into<span class="o">=</span><span class="kt">c</span><span class="p">(</span><span class="s">&#39;sample_num&#39;</span><span class="p">,</span> <span class="s">&#39;enrichment&#39;</span><span class="p">,</span> <span class="s">&#39;person&#39;</span><span class="p">))</span> <span class="o">%&gt;%</span>
unite<span class="p">(</span>Label<span class="p">,</span> <span class="kt">c</span><span class="p">(</span><span class="s">&#39;sample_num&#39;</span><span class="p">,</span> <span class="s">&#39;enrichment&#39;</span><span class="p">,</span> <span class="s">&#39;person&#39;</span><span class="p">),</span> sep<span class="o">=</span><span class="s">&#39;_&#39;</span><span class="p">)</span> <span class="o">%&gt;%</span>
<span class="kp">head</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<table>
<thead><tr><th scope=col>Label</th><th scope=col>concentration_fold_difference</th></tr></thead>
<tbody>
    <tr><td>2_MA_C </td><td>1.34   </td></tr>
    <tr><td>9_MA_C </td><td>2.23   </td></tr>
    <tr><td>10_MA_C</td><td>4.37   </td></tr>
    <tr><td>14_MA_C</td><td>1.57   </td></tr>
    <tr><td>15_MA_C</td><td>2.85   </td></tr>
    <tr><td>21_MA_C</td><td>1.81   </td></tr>
</tbody>
</table></div>
</div>
<p>Sometiems there is no simple delimiter between parts of a value. In such
cases, we may need to use reuglar expressions to extract parts from a
string.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [293]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span>bad_labels <span class="o">&lt;-</span> df <span class="o">%&gt;%</span>
select<span class="p">(</span>Label<span class="p">,</span> concentration_fold_difference<span class="p">)</span> <span class="o">%&gt;%</span>
separate<span class="p">(</span>Label<span class="p">,</span>
         sep<span class="o">=</span><span class="s">&#39;_&#39;</span><span class="p">,</span>
         into<span class="o">=</span><span class="kt">c</span><span class="p">(</span><span class="s">&#39;sample_num&#39;</span><span class="p">,</span> <span class="s">&#39;enrichment&#39;</span><span class="p">,</span> <span class="s">&#39;person&#39;</span><span class="p">))</span> <span class="o">%&gt;%</span>
unite<span class="p">(</span>Label<span class="p">,</span> <span class="kt">c</span><span class="p">(</span><span class="s">&#39;sample_num&#39;</span><span class="p">,</span> <span class="s">&#39;enrichment&#39;</span><span class="p">,</span> <span class="s">&#39;person&#39;</span><span class="p">),</span> sep<span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
<span class="kp">head</span><span class="p">(</span>bad_labels<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<table>
<thead><tr><th scope=col>Label</th><th scope=col>concentration_fold_difference</th></tr></thead>
<tbody>
    <tr><td>2MAC </td><td>1.34 </td></tr>
    <tr><td>9MAC </td><td>2.23 </td></tr>
    <tr><td>10MAC</td><td>4.37 </td></tr>
    <tr><td>14MAC</td><td>1.57 </td></tr>
    <tr><td>15MAC</td><td>2.85 </td></tr>
    <tr><td>21MAC</td><td>1.81 </td></tr>
</tbody>
</table></div>
</div>
<p>The regular expression consists of 3 capture groups in parentheses that
will form the new columns.</p>
<p><code class="docutils literal notranslate"><span class="pre">'([0-9]+)(.*)(.$)'</span></code></p>
<p>where</p>
<ul class="simple">
<li>Capture group 1 <code class="docutils literal notranslate"><span class="pre">[0-9]+</span></code> means match one or more <code class="docutils literal notranslate"><span class="pre">+</span></code> of any
digits <code class="docutils literal notranslate"><span class="pre">[0-9]</span></code></li>
<li>Capture group 2 <code class="docutils literal notranslate"><span class="pre">.*</span></code> means match zero or more <code class="docutils literal notranslate"><span class="pre">*</span></code> of any
character <code class="docutils literal notranslate"><span class="pre">.</span></code></li>
<li>Capture gorup 3 <code class="docutils literal notranslate"><span class="pre">.$</span></code> means match any character <code class="docutils literal notranslate"><span class="pre">.</span></code> at the end
<code class="docutils literal notranslate"><span class="pre">$</span></code></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [306]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span>bad_labels <span class="o">%&gt;%</span>
extract<span class="p">(</span>Label<span class="p">,</span>
         into<span class="o">=</span><span class="kt">c</span><span class="p">(</span><span class="s">&#39;sample_num&#39;</span><span class="p">,</span> <span class="s">&#39;enrichment&#39;</span><span class="p">,</span> <span class="s">&#39;person&#39;</span><span class="p">),</span>
         <span class="s">&#39;([0-9]+)(.*)(.$)&#39;</span><span class="p">)</span> <span class="o">%&gt;%</span>
<span class="kp">head</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<table>
<thead><tr><th scope=col>sample_num</th><th scope=col>enrichment</th><th scope=col>person</th><th scope=col>concentration_fold_difference</th></tr></thead>
<tbody>
    <tr><td>2   </td><td>MA  </td><td>C   </td><td>1.34</td></tr>
    <tr><td>9   </td><td>MA  </td><td>C   </td><td>2.23</td></tr>
    <tr><td>10  </td><td>MA  </td><td>C   </td><td>4.37</td></tr>
    <tr><td>14  </td><td>MA  </td><td>C   </td><td>1.57</td></tr>
    <tr><td>15  </td><td>MA  </td><td>C   </td><td>2.85</td></tr>
    <tr><td>21  </td><td>MA  </td><td>C   </td><td>1.81</td></tr>
</tbody>
</table></div>
</div>
<div class="section" id="Using-separate_rows-rows-when-multiple-values-are-in-a-single-cell.">
<h3>Using <code class="docutils literal notranslate"><span class="pre">separate_rows</span></code> rows when multiple values are in a single cell.<a class="headerlink" href="#Using-separate_rows-rows-when-multiple-values-are-in-a-single-cell." title="Permalink to this headline">¶</a></h3>
<p>Very occassionally, we find data sets where multiple values are stored
in a single cell. We will make up and exmple here as this does not occur
in the metadata data set.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [330]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span>bad_primer <span class="o">&lt;-</span> df <span class="o">%&gt;%</span>
select<span class="p">(</span>Label<span class="p">,</span> <span class="sb">`i5 index`</span><span class="p">,</span> <span class="sb">`i7 index`</span><span class="p">)</span> <span class="o">%&gt;%</span>
unite<span class="p">(</span>primer<span class="p">,</span> <span class="kt">c</span><span class="p">(</span><span class="sb">`i5 index`</span><span class="p">,</span> <span class="sb">`i7 index`</span><span class="p">),</span> sep<span class="o">=</span><span class="s">&#39;,&#39;</span><span class="p">)</span> <span class="o">%&gt;%</span>
arrange<span class="p">(</span>Label<span class="p">)</span>
<span class="kp">head</span><span class="p">(</span>bad_primer<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<table>
<thead><tr><th scope=col>Label</th><th scope=col>primer</th></tr></thead>
<tbody>
    <tr><td>1_MA_J           </td><td>AGGCTATA,CGCTCATT</td></tr>
    <tr><td>1_RZ_J           </td><td>AGGCTATA,GAGATTCC</td></tr>
    <tr><td>10_MA_C          </td><td>AGGATAGG,ATTACTCG</td></tr>
    <tr><td>10_RZ_C          </td><td>AGGATAGG,TCCGGAGA</td></tr>
    <tr><td>11_MA_J          </td><td>AGGATAGG,CGCTCATT</td></tr>
    <tr><td>11_RZ_J          </td><td>AGGATAGG,GAGATTCC</td></tr>
</tbody>
</table></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [331]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span>bad_primer <span class="o">%&gt;%</span>
separate_rows<span class="p">(</span>primer<span class="p">,</span> sep<span class="o">=</span><span class="s">&#39;,&#39;</span><span class="p">)</span> <span class="o">%&gt;%</span>
<span class="kp">head</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<table>
<thead><tr><th scope=col>Label</th><th scope=col>primer</th></tr></thead>
<tbody>
    <tr><td>1_MA_J  </td><td>AGGCTATA</td></tr>
    <tr><td>1_MA_J  </td><td>CGCTCATT</td></tr>
    <tr><td>1_RZ_J  </td><td>AGGCTATA</td></tr>
    <tr><td>1_RZ_J  </td><td>GAGATTCC</td></tr>
    <tr><td>10_MA_C </td><td>AGGATAGG</td></tr>
    <tr><td>10_MA_C </td><td>ATTACTCG</td></tr>
</tbody>
</table></div>
</div>
<div class="section" id="Challenge:-Reconstruct-column-structure-of-orignial-metadata-file">
<h4>Challenge: Reconstruct column structure of orignial metadata file<a class="headerlink" href="#Challenge:-Reconstruct-column-structure-of-orignial-metadata-file" title="Permalink to this headline">¶</a></h4>
<p>Since <code class="docutils literal notranslate"><span class="pre">separate_rows</span></code> will place the items in each row in alternating
columns, we create a temporary variable to store the position in the
original cell.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [332]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span>bad_primer <span class="o">%&gt;%</span>
separate_rows<span class="p">(</span>primer<span class="p">,</span> sep<span class="o">=</span><span class="s">&#39;,&#39;</span><span class="p">)</span> <span class="o">%&gt;%</span>
mutate<span class="p">(</span>tmp<span class="o">=</span><span class="kp">rep_len</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">,</span> n<span class="p">()))</span> <span class="o">%&gt;%</span>
<span class="kp">head</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<table>
<thead><tr><th scope=col>Label</th><th scope=col>primer</th><th scope=col>tmp</th></tr></thead>
<tbody>
    <tr><td>1_MA_J  </td><td>AGGCTATA</td><td>1       </td></tr>
    <tr><td>1_MA_J  </td><td>CGCTCATT</td><td>2       </td></tr>
    <tr><td>1_RZ_J  </td><td>AGGCTATA</td><td>1       </td></tr>
    <tr><td>1_RZ_J  </td><td>GAGATTCC</td><td>2       </td></tr>
    <tr><td>10_MA_C </td><td>AGGATAGG</td><td>1       </td></tr>
    <tr><td>10_MA_C </td><td>ATTACTCG</td><td>2       </td></tr>
</tbody>
</table></div>
</div>
<p>We then <code class="docutils literal notranslate"><span class="pre">spread</span></code> the primer values by the temporary variable and
rename the columns as appropriate.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [333]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span>bad_primer <span class="o">%&gt;%</span>
separate_rows<span class="p">(</span>primer<span class="p">,</span> sep<span class="o">=</span><span class="s">&#39;,&#39;</span><span class="p">)</span> <span class="o">%&gt;%</span>
mutate<span class="p">(</span>tmp<span class="o">=</span><span class="kp">rep_len</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">,</span> n<span class="p">()))</span> <span class="o">%&gt;%</span>
spread<span class="p">(</span>tmp<span class="p">,</span> primer<span class="p">)</span> <span class="o">%&gt;%</span>
rename<span class="p">(</span><span class="sb">`i5 index`</span><span class="o">=</span><span class="sb">`1`</span><span class="p">,</span> <span class="sb">`i7 index`</span><span class="o">=</span><span class="sb">`2`</span><span class="p">)</span> <span class="o">%&gt;%</span>
<span class="kp">head</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<table>
<thead><tr><th scope=col>Label</th><th scope=col>i5 index</th><th scope=col>i7 index</th></tr></thead>
<tbody>
    <tr><td>1_MA_J  </td><td>AGGCTATA</td><td>CGCTCATT</td></tr>
    <tr><td>1_RZ_J  </td><td>AGGCTATA</td><td>GAGATTCC</td></tr>
    <tr><td>10_MA_C </td><td>AGGATAGG</td><td>ATTACTCG</td></tr>
    <tr><td>10_RZ_C </td><td>AGGATAGG</td><td>TCCGGAGA</td></tr>
    <tr><td>11_MA_J </td><td>AGGATAGG</td><td>CGCTCATT</td></tr>
    <tr><td>11_RZ_J </td><td>AGGATAGG</td><td>GAGATTCC</td></tr>
</tbody>
</table></div>
</div>
<p>Comapre with original</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [334]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span>df <span class="o">%&gt;%</span>
select<span class="p">(</span>Label<span class="p">,</span> <span class="sb">`i5 index`</span><span class="p">,</span> <span class="sb">`i7 index`</span><span class="p">)</span> <span class="o">%&gt;%</span>
arrange<span class="p">(</span>Label<span class="p">)</span> <span class="o">%&gt;%</span>
<span class="kp">head</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<table>
<thead><tr><th scope=col>Label</th><th scope=col>i5 index</th><th scope=col>i7 index</th></tr></thead>
<tbody>
    <tr><td>1_MA_J  </td><td>AGGCTATA</td><td>CGCTCATT</td></tr>
    <tr><td>1_RZ_J  </td><td>AGGCTATA</td><td>GAGATTCC</td></tr>
    <tr><td>10_MA_C </td><td>AGGATAGG</td><td>ATTACTCG</td></tr>
    <tr><td>10_RZ_C </td><td>AGGATAGG</td><td>TCCGGAGA</td></tr>
    <tr><td>11_MA_J </td><td>AGGATAGG</td><td>CGCTCATT</td></tr>
    <tr><td>11_RZ_J </td><td>AGGATAGG</td><td>GAGATTCC</td></tr>
</tbody>
</table></div>
</div>
</div>
</div>
</div>
<div class="section" id="Challenge-exercise">
<h2>Challenge exercise<a class="headerlink" href="#Challenge-exercise" title="Permalink to this headline">¶</a></h2>
<p>Let’s look at the index and primer columne more closely. It seems that
the index and primer values are linked and are just different ways of
labeling the same thing. So we really should be have columns like this</p>
<table border="1" class="docutils">
<colgroup>
<col width="44%" />
<col width="22%" />
<col width="33%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">primer_type</th>
<th class="head">code</th>
<th class="head">seq</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>i5</td>
<td>i501</td>
<td>AGGCTATA</td>
</tr>
<tr class="row-odd"><td>i5</td>
<td>i502</td>
<td>GCCTCTAT</td>
</tr>
<tr class="row-even"><td>i7</td>
<td>i701</td>
<td>ATTACTCG</td>
</tr>
<tr class="row-odd"><td>i7</td>
<td>i702</td>
<td>TCCGGAGA</td>
</tr>
</tbody>
</table>
<p>We can do this by combining the operatios we have seen above.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [232]:
</pre></div>
</div>
<div class="input_area highlight-r notranslate"><div class="highlight"><pre>
<span></span>df <span class="o">%&gt;%</span>
unite<span class="p">(</span>i7<span class="p">,</span> <span class="kt">c</span><span class="p">(</span><span class="sb">`i7 primer`</span><span class="p">,</span> <span class="sb">`i7 index`</span><span class="p">),</span> sep<span class="o">=</span><span class="s">&#39;:&#39;</span><span class="p">)</span> <span class="o">%&gt;%</span>
unite<span class="p">(</span>i5<span class="p">,</span> <span class="kt">c</span><span class="p">(</span><span class="sb">`i5 primer`</span><span class="p">,</span> <span class="sb">`i5 index`</span><span class="p">),</span> sep<span class="o">=</span><span class="s">&#39;:&#39;</span><span class="p">)</span> <span class="o">%&gt;%</span>
gather<span class="p">(</span>primer_type<span class="p">,</span> val<span class="p">,</span> <span class="kt">c</span><span class="p">(</span>i7<span class="p">,</span> i5<span class="p">))</span> <span class="o">%&gt;%</span>
separate<span class="p">(</span>val<span class="p">,</span> into<span class="o">=</span><span class="kt">c</span><span class="p">(</span><span class="s">&#39;code&#39;</span><span class="p">,</span> <span class="s">&#39;seq&#39;</span><span class="p">),</span> sep<span class="o">=</span><span class="s">&#39;:&#39;</span><span class="p">)</span> <span class="o">%&gt;%</span>
mutate<span class="p">(</span>code<span class="o">=</span>str_extract<span class="p">(</span>code<span class="p">,</span> <span class="s">&#39;..$&#39;</span><span class="p">))</span> <span class="o">%&gt;%</span>
arrange<span class="p">(</span>primer_type<span class="p">,</span> code<span class="p">)</span> <span class="o">%&gt;%</span>
<span class="kp">head</span><span class="p">(</span><span class="m">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<table>
<thead><tr><th scope=col>Label</th><th scope=col>RNA_sample_num</th><th scope=col>Media</th><th scope=col>Strain</th><th scope=col>Replicate</th><th scope=col>concentration_fold_difference</th><th scope=col>primer_type</th><th scope=col>code</th><th scope=col>seq</th></tr></thead>
<tbody>
    <tr><td>2_MA_C  </td><td>2       </td><td>YPD     </td><td>H99     </td><td>2       </td><td>1.34    </td><td>i5      </td><td>01      </td><td>AGGCTATA</td></tr>
    <tr><td>2_RZ_C  </td><td>2       </td><td>YPD     </td><td>H99     </td><td>2       </td><td>1.34    </td><td>i5      </td><td>01      </td><td>AGGCTATA</td></tr>
    <tr><td>2_TOT_C </td><td>2       </td><td>YPD     </td><td>H99     </td><td>2       </td><td>1.34    </td><td>i5      </td><td>01      </td><td>AGGCTATA</td></tr>
    <tr><td>1_MA_J  </td><td>1       </td><td>YPD     </td><td>H99     </td><td>1       </td><td>3.64    </td><td>i5      </td><td>01      </td><td>AGGCTATA</td></tr>
    <tr><td>1_RZ_J  </td><td>1       </td><td>YPD     </td><td>H99     </td><td>1       </td><td>3.64    </td><td>i5      </td><td>01      </td><td>AGGCTATA</td></tr>
    <tr><td>4_MA_P  </td><td>4       </td><td>YPD     </td><td>H99     </td><td>4       </td><td>2.05    </td><td>i5      </td><td>01      </td><td>AGGCTATA</td></tr>
    <tr><td>4_RZ_P  </td><td>4       </td><td>YPD     </td><td>H99     </td><td>4       </td><td>2.05    </td><td>i5      </td><td>01      </td><td>AGGCTATA</td></tr>
    <tr><td>9_MA_C  </td><td>9       </td><td>YPD     </td><td>mar1d   </td><td>3       </td><td>2.23    </td><td>i5      </td><td>02      </td><td>GCCTCTAT</td></tr>
    <tr><td>9_RZ_C  </td><td>9       </td><td>YPD     </td><td>mar1d   </td><td>3       </td><td>2.23    </td><td>i5      </td><td>02      </td><td>GCCTCTAT</td></tr>
    <tr><td>3_MA_J  </td><td>3       </td><td>YPD     </td><td>H99     </td><td>3       </td><td>1.98    </td><td>i5      </td><td>02      </td><td>GCCTCTAT</td></tr>
</tbody>
</table></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Cliburn Chan.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.0',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  <script type="text/javascript">
      jQuery(function () {
          
          SphinxRtdTheme.Navigation.enableSticky();
          
      });
  </script> 

</body>
</html>